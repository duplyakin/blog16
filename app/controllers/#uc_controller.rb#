class UcsController < ApplicationController
	
  before_filter :authenticate_user!  
  before_filter :find_user,                   only: [:show,:edit,:update, :destroy]
  before_filter :allow_only_admins,           only: [:index,:edit,:update, :destroy]
  after_filter  :log_user_action,             only: [:update, :destroy]	 	
  def index
    @users = User.all
  end
  
  def show
    unless  @user 
    render_404
    end  	    
  end
  
 # def new
  #  @user = User.new
  #end
  
  def edit
  end
  
  #def create 
    #render text: params.inspect
   # @user = User.create(params[:user])
    #if @user.errors.empty?
     # redirect_to uc_path(@user)
    #else
     # "new"
    #end
  #end
  
  def update 
    @user.update_attributes(params[:user])
    if @user.errors.empty?
      redirect_to ucs_path(@user)
    else
      "edit"
    end
  end
  
  def destroy
    @user.destroy
    redirect_to action: "index"
  end
  
  private 
  
  def find_user
    @user = User.where(id: params[:id]).first
    render_404 unless @user
    
  end
  
  def log_user_action
    if current_user && ( current_user.role == "admin" || current_user.role == "moderator" )
      UserAction.create(
        user: current_user, 
        description: 
      	        "Controller: #{params[:controller]}, Action: #{params[:action]}"
    )
    end
  end
  
  
  
end

